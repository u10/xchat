webpackJsonp([2,0],{0:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}s(130),s(68);var i=s(37),r=o(i),n=s(168),a=o(n),u=s(40),l=o(u);s(65),window.vm=new r["default"]({el:"body",store:l["default"],components:{Chat:a["default"]}});var d=/(?:\?|&)lang=(\w+)(?:$|&)/.exec(window.location.search);d=d?d[1]:"chs",r["default"].config.lang=d},18:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UPDATE_USER_LIST="UPDATE_USER_LIST",t.CLEAR_MESSAGE="CLEAR_MESSAGE",t.APPEND_MESSAGE="APPEND_MESSAGE",t.SET_SEND_TO="SET_SEND_TO"},39:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.user=function(e){return e.user},t.room=function(e){return e.room},t.userList=function(e){return e.userList},t.messageList=function(e){return e.messageList}},40:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r=s(82),n=o(r),a=s(37),u=o(a),l=s(176),d=o(l),c=s(18);u["default"].use(d["default"]);var p={id:(new Date).getTime()+"",name:window.localStorage.getItem("user.name")||"guest-"+parseInt(1e3*Math.random()),password:"123456"},f={user:p,userList:[],messageList:[],room:{}},v=(i={},(0,n["default"])(i,c.UPDATE_USER_LIST,function(e,t){e.userList=t}),(0,n["default"])(i,c.CLEAR_MESSAGE,function(e){e.messageList=[]}),(0,n["default"])(i,c.APPEND_MESSAGE,function(e,t){t.user=t.user||e.user,t.type=t.type||"TextMessage",e.messageList.push(t)}),(0,n["default"])(i,c.SET_SEND_TO,function(e,t){e.room=t}),i);t["default"]=new d["default"].Store({state:f,mutations:v})},65:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var i=s(37),r=o(i),n=s(167),a=o(n),u=s(67),l=o(u),d=s(66),c=o(d);r["default"].use(a["default"]),r["default"].locale("en",l["default"]),r["default"].locale("chs",c["default"])},66:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={UI:{Login:"登录",Logout:"登出",Me:"我",SendFile:"发送文件",SendText:"发送文本",Broadcast:"广播",ClearMessage:"清空消息",SendTo:"发送到",EveryOne:"所有人",DefaultText:"文本消息"},Error:{FileTypeNotSupported:"发送失败(不支持该类型的文件)."}}},67:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={UI:{Login:"Login",Logout:"Logout",Me:"Me",SendFile:"Send File",SendText:"Send Text",Broadcast:"Broadcast",ClearMessage:"Clear Message",SendTo:"Send to",EveryOne:"Every One",DefaultText:"Text Message"},Error:{FileTypeNotSupported:"File type not supported."}}},68:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var i=s(129),r=o(i),n=function(e,t,s){r["default"].isUndefined(e[t])&&(e[t]=s)};n(Date.prototype,"format",function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(""+this.getFullYear()).substr(4-RegExp.$1.length)));for(var s in t){var o=t[s];new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o:("00"+o).substr((""+o).length)))}return e})},69:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=s(131),r=o(i),n=s(115),a=s(18),u=s(40),l=o(u),d=(""+window.location.pathname).replace(/\/$/,""),c=(0,r["default"])("ws://"+window.location.host,{path:d+"/socket.io",autoConnect:!1}),p={};c.on("broadcast",function(e){l["default"].dispatch("UPDATE_USER_LIST",e)}).on("msg",function(e){l["default"].dispatch("APPEND_MESSAGE",e)}).on("file",function(e){var t=p[e.fid];if(t&&0!==t.size){var s=function(s){var o=new n.BinaryClient("ws://"+window.location.host+d+"/binary");o.on("open",function(i){var r=void 0,n=void 0,a=void 0,u=void 0;return i=o.createStream({name:encodeURIComponent(t.name),size:t.size,type:t.type,tid:e.tid}),i.on("data",function(e){e.name=t.name,"function"==typeof s&&s(e)}),a=0,r=131072,n=function(e){return i.write(e.target.result),a+=r,a<t.size?u():i.end()},(u=function(){var e=t.slice(a,a+r),s=new window.FileReader;s.onloadend=n,s.readAsArrayBuffer(e)})()})},o={local:!0,type:"ProgressMessage",msg:"正在发送文件: "+t.name,progress:0};l["default"].dispatch(a.APPEND_MESSAGE,o),s(function(e){o.progress=parseInt(100*e.tx)})}}),t["default"]={login:function(e,t){c.once("connect",function(){c.emit("login",e),c.once("login",function(){t(c.id)})}),c.connect()},logout:function(){c.disconnect()},sendFile:function(e,t){l["default"].dispatch(a.APPEND_MESSAGE,{local:!0,msg:"发送文件: "+t.name+"("+(parseInt(t.size/1024/10.24)/100||"<0.01")+" MB)"});var s=(new Date).getTime();p[s]=t,c.emit("file",{fid:s,room:e.id,name:t.name,size:t.size})},sendText:function(e,t){l["default"].dispatch(a.APPEND_MESSAGE,{local:!0,msg:t}),c.emit("msg",{room:e.id,msg:t})}}},70:function(e,t,s){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.setSendTo=t.appendMessage=t.clearUserList=t.clearMessage=void 0;var i=s(18),r=o(i);t.clearMessage=function(e){var t=e.dispatch;t(r.CLEAR_MESSAGE)},t.clearUserList=function(e){var t=e.dispatch;t(r.UPDATE_USER_LIST,[])},t.appendMessage=function(e,t){var s=e.dispatch;s(r.APPEND_MESSAGE,t)},t.setSendTo=function(e,t){var s=e.dispatch;s(r.SET_SEND_TO,t)}},71:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=s(83),r=o(i),n=s(51),a=o(n),u=s(173),l=o(u),d=s(169),c=o(d),p=s(171),f=o(p),v=s(70),m=s(39),g=s(158),x=o(g),_=s(69),b=o(_);t["default"]={vuex:{getters:{user:m.user,room:m.room,userList:m.userList,messageList:m.messageList},actions:{setSendTo:v.setSendTo,clearMessage:v.clearMessage,appendMessage:v.appendMessage,clearUserList:v.clearUserList}},data:function(){return{textMessage:""}},computed:{roomName:function(){return this.room.name?this.room.name:this.$t("UI.EveryOne")},isLogin:function(){return this.userList.length>0}},methods:{login:function(){var e=this.user;b["default"].login(e,function(t){e.id=t})},logout:function(){b["default"].logout(),this.clearUserList(),this.setSendTo({})},setBroadcast:function(){this.setSendTo({})},sendText:function(){b["default"].sendText(this.room,this.textMessage)},sendFile:function(e){b["default"].sendFile(this.room,e[0])},dropFiles:function(e){var t=this;if(e.length>0){var s=function(){var s=t.room;return e.forEach(function(e){b["default"].sendFile(s,e)}),{v:void 0}}();if("object"===("undefined"==typeof s?"undefined":(0,r["default"])(s)))return s.v}this.appendMessage({local:!0,type:"ErrorMessage",msg:this.$t("Error.FileTypeNotSupported")})},selectUser:function(e){this.setSendTo(e)}},watch:{"user.name":function(e){window.localStorage.setItem("user.name",e)},messageList:function(){(0,a["default"])(".msg-scroll").scrollTop(9999)}},ready:function(){(0,x["default"])(["#top","#bottom"],{sizes:[70,30],direction:"vertical",gutterSize:6,cursor:"row-resize",minSize:200}),(0,x["default"])(["#top-left","#top-right"],{sizes:[25,75],gutterSize:6,cursor:"col-resize",minSize:150})},components:{MessageItem:l["default"],DropBox:c["default"],File:f["default"]}}},72:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={props:{model:Object},methods:{dragenter:function(e){var t=e.dataTransfer;-1!==t.types.indexOf("Files")&&(e.stopPropagation(),e.preventDefault())},dragover:function(e){var t=e.dataTransfer;-1!==t.types.indexOf("Files")&&(e.stopPropagation(),e.preventDefault())},drop:function(e){var t=e.dataTransfer;if(-1!==t.types.indexOf("Files")){e.stopPropagation(),e.preventDefault();for(var s=[],o=0,i=t.files.length;i>o;o++){var r=void 0,n=t.items[o];"function"==typeof n.webkitGetAsEntry&&(r=n.webkitGetAsEntry(n))&&r.isDirectory||s.push(t.files[o])}this.$dispatch("drop-files",s)}}}}},73:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={props:{model:Object}}},74:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=s(51),r=o(i);t["default"]={ready:function(){var e=this,t=(0,r["default"])('<input type="file" />').on("change",function(){e.$dispatch("change",t[0].files),t.val("")});this.$file=t},props:{model:Object},computed:{},methods:{onClick:function(){this.$file.trigger("click")}}}},75:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={props:{model:Object}}},76:function(e,t,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=s(175),r=o(i),n=s(170),a=o(n),u=s(172),l=o(u),d=s(174),c=o(d),p=s(39);t["default"]={vuex:{getters:{user:p.user}},props:{model:Object},components:{TextMessage:r["default"],ErrorMessage:a["default"],LinkMessage:l["default"],ProgressMessage:c["default"]}}},77:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={props:{model:Object}}},78:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={props:{model:Object},methods:{copyText:function(e){document.execCommand("copy")}}}},126:function(e,t){},127:function(e,t){},128:function(e,t){},159:function(e,t){e.exports='<div class="flex v-flex fill"> <div class=flex-box> <div class=flex-ctrl> <div class=flex-content> <div id=top class=split> <div id=top-left class="split split-horizontal"> <div v-if=isLogin transition=vs-fade class="flex-box v-flex"> <div class="pure-form pure-g"> <div class=pure-u-1> <div class=l-box> <button class="pure-u-1-1 pure-button button-error" @click=logout> {{$t(\'UI.Logout\')}}({{user.name}}) </button> </div> </div> </div> <div class="flex-ctrl margin-s"> <div class="flex-content pure-form pure-g"> <div class=pure-u-1> <div class=l-box> <div class="pure-u-1 user-list"> <template v-for="item in userList"> <li @click=selectUser(item)>{{item.name}}{{item.id===user.id?\'(\'+$t(\'UI.Me\')+\')\':\'\'}}</li> </template> </div> </div> </div> </div> </div> </div> <div v-else class="pure-form pure-g" transition=vs-fade> <div class=pure-u-1> <div class=l-box> <input class=pure-u-1 v-model=user.name success-msg=Success error-msg=Error /> </div> <div class=l-box> <input class=pure-u-1 v-model=user.password type=password success-msg=Success error-msg=Error /> </div> <div class=l-box> <button class="pure-u-1 pure-button pure-button-primary" @click=login>{{$t(\'UI.Login\')}} </button> </div> </div> </div> </div> <div id=top-right class="split split-horizontal"> <div class="flex-box v-flex"> <div class="pure-form pure-g"> <div class=pure-u-1> <div class=l-box> <button class="pure-u-1 pure-button button-secondary" @click=clearMessage> {{$t(\'UI.ClearMessage\')}} </button> </div> </div> </div> <div class=flex-ctrl> <div class="flex-content pure-form pure-g msg-scroll"> <div class=pure-u-1> <div class="pure-u-1 message-list"> <div v-for="item in messageList" transition=vs-fade> <message-item :model=item></message-item> </div> </div> </div> </div> </div> </div> </div> </div> <div id=bottom class=split> <div class="flex v-flex fill"> <div class=pure-form> <div class=pure-g> <div class=pure-u-1-5> <div class=l-box> <label class=pure-u-1>{{$t(\'UI.SendTo\')}}</label> </div> </div> <div class=pure-u-3-5> <div class=l-box> <input class=pure-u-1 type=text readonly=readonly v-model=roomName /> </div> </div> <div class=pure-u-1-5> <div class=l-box> <button class="pure-u-1 pure-button button-secondary" @click=setBroadcast :disabled=!isLogin> {{$t(\'UI.Broadcast\')}} </button> </div> </div> </div> </div> <div class=flex-box> <div class="flex-ctrl margin-s"> <div class="flex-content pure-form pure-g"> <drop-box class=fill @drop-files=dropFiles> <textarea class="pure-input-1 text-message" v-model=textMessage placeholder="{{$t(\'UI.DefaultText\')}}" :disabled=!isLogin></textarea> </drop-box> </div> </div> </div> <div class=pure-form> <div class=pure-g> <div class="pure-u-2-5 pure-u-md-1-5"> <div class=l-box> <file class=pure-u-1 @change=sendFile> <button class="pure-u-1 pure-button button-secondary" :disabled=!isLogin> {{$t(\'UI.SendFile\')}} </button> </file> </div> </div> <div class="pure-u-3-5 pure-u-md-4-5"> <div class=l-box> <button class="pure-u-1 pure-button button-secondary" @click=sendText :disabled=!isLogin> {{$t(\'UI.SendText\')}} </button> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div>'},160:function(e,t){e.exports="<div @drop=drop @dragover=dragover @dragenter=dragenter> <slot></slot> </div>"},161:function(e,t){e.exports='<div class="card-panel error">{{model.msg}}</div>'},162:function(e,t){e.exports="<div @click=onClick><slot></slot></div>"},163:function(e,t){e.exports="<div class=card-panel> <a :href=model.href target=_blank>{{model.msg}}</a> </div>"},164:function(e,t){e.exports='<div class="card-panel progress">{{model.msg}} {{model.progress}}%</div>'},165:function(e,t){e.exports='<div class=pure-g _v-7e92b406=""> <div class="pure-u-1 {{model.local?\'local\':\'\'}}" _v-7e92b406=""> <div class=l-box _v-7e92b406=""> <div class=msg-sender _v-7e92b406=""> [{{model.user.id===user.id?$t(\'UI.Me\'):model.user.name}}{{model.broadcast?\'(\'+$t(\'UI.Broadcast\')+\')\':\'\'}}] <span class=msg-time _v-7e92b406="">{{* new Date().format(\'yyyy-MM-dd hh:mm:ss\')}}</span> </div> </div> </div> </div> <div class=pure-g _v-7e92b406=""> <div class=pure-u-1 _v-7e92b406=""> <div class=l-box _v-7e92b406=""> <component :is=model.type :model=model _v-7e92b406=""></component> </div> </div> </div>'},166:function(e,t){e.exports="<pre class=\"card-panel {{model.local?'local-msg':''}}\" _v-cfcf0f46=\"\">{{model.msg}}</pre>"},168:function(e,t,s){var o,i;s(126),o=s(71),i=s(159),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},169:function(e,t,s){var o,i;o=s(72),i=s(160),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},170:function(e,t,s){var o,i;o=s(73),i=s(161),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},171:function(e,t,s){var o,i;o=s(74),i=s(162),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},172:function(e,t,s){var o,i;o=s(75),i=s(163),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},173:function(e,t,s){var o,i;s(127),o=s(76),i=s(165),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},174:function(e,t,s){var o,i;o=s(77),i=s(164),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},175:function(e,t,s){var o,i;s(128),o=s(78),i=s(166),e.exports=o||{},e.exports.__esModule&&(e.exports=e.exports["default"]),i&&(("function"==typeof e.exports?e.exports.options||(e.exports.options={}):e.exports).template=i)},181:function(e,t){}});