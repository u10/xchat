!function(e){function n(t){if(o[t])return o[t].exports;var r=o[t]={exports:{},id:t,loaded:!1};return e[t].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var o={};return n.m=e,n.c=o,n.p="",n(0)}([function(e,n,o){var t,r,i,u,c,a,s,l,f,d,p,m,v;l=o(1),f=o(2),a=o(3),s=o(4),p=o(5)(__dirname+"/.."),t=o(7),i=o(11),r=o(13),u=o(14).parseArgs(),m=a(),v=f.createServer(m),m.use(s(p.wwwroot("static","img","favicon.ico"))),m.use(a["static"](p.wwwroot())),d=i({server:v}),c=t(d,{path:"/binary"}),m.use("/download",r(c)),v.listen(u.port,u.addr,function(e){return e?void console.log(e):console.log("XChat at http://"+u.addr+":"+u.port)})},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("http")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("serve-favicon")},function(e,n,o){var t,r,i,u=[].slice;r=o(1),i=o(6),t=function(){var e;return e=1<=arguments.length?u.call(arguments,0):[],e=i.resolve(i.join.apply(i,e)),function(){var n;return n=1<=arguments.length?u.call(arguments,0):[],n[n.length-1]===!0?(n.length--,t.apply(null,[e].concat(u.call(n)))):i.resolve(i.join.apply(i,[e].concat(u.call(n))))}},e.exports=function(e){var n,o,u;for(u=t(e),n=u();-1===r.readdirSync(n).indexOf("node_modules")&&(o=i.resolve(n+"/.."),n!==o);)n=o;return n=t(n,"node_modules"),{join:i.join,normalize:function(e){return i.normalize(e.replace(/\\|\//g,i.sep))},node_modules:n,root:u,data:u("data",!0),wwwroot:u("wwwroot",!0)}}},function(e,n){e.exports=require("path")},function(e,n,o){var t,r,i;i=o(8),r=o(9),t=o(10).BinaryServer,e.exports=function(e,n){var o;return o={},new t(i.extend({server:e.httpServer},n)).on("connection",function(e){e.on("stream",function(n,t){var r,i,u;return i=t.tid,r=o[i],delete o[i],r?(clearTimeout(r.timeout),r.onStart(t),u=0,n.on("data",function(e){u+=e.length,n.write({tx:u/t.size})}),n.on("error",function(){r.onError()}),void r.onPipe(n)):void e.close()})}),{connect:function(n){var t;t=r.create().hex,o[t]=n,n.timeout=setTimeout(function(){delete o[t],n.onTimeout()},n.timeout||5e3),e.to(n.room).emit("file",{fid:n.fileId,tid:t})}}}},function(e,n){e.exports=require("lodash")},function(e,n){e.exports=require("uuid-js")},function(e,n){e.exports=require("binaryjs")},function(e,n,o){var t;t=o(12),e.exports=function(e){var n,o,r,i;return r=t.listen(e.server),o=function(){var e,n,o,t;n=r.sockets.connected,o=[];for(e in n)t=n[e],o.push(t.user);return o},n=function(){return r.emit("broadcast",o())},i=function(e,n){var o;n.user=e.user,o=n.room,o?r.to(o).emit("msg",n):(n.broadcast=!0,r.emit("msg",n))},r.on("connect",function(e){console.log("connected."+e.id),e.on("login",function(o){null==o&&(o={}),e.user=o,o.id=e.id,n(),e.emit("login",o)}).on("join",function(n){var o;null==n&&(n={}),o=n.room,o&&(e.join(o),r.to(o).emit("sys","new user"))}).on("leave",function(n){var o;null==n&&(n={}),o=n.room,o&&(r.to(o).emit("sys","user leave"),setTimeout(function(){e.leave(o)},0))}).on("msg",function(n){null==n&&(n={}),i(e,n)}).on("list",function(){console.log(e.rooms)}).on("file",function(n){null==n&&(n={}),i(e,{room:n.room,type:"LinkMessage",href:"download/"+e.id+"/"+n.fid,msg:decodeURIComponent(n.name)+"("+(parseInt(n.size/1024/10.24)/100||"<0.01")+"MB)"})}).on("disconnect",function(){n(),console.log("disconnected.")})}),r}},function(e,n){e.exports=require("socket.io")},function(e,n,o){var t;t=o(3),e.exports=function(e){var n;return n=t.Router(),n.route("/:uid/:fid").get(function(n,o){e.connect({room:n.params.uid,fileId:n.params.fid,timeout:2e3,onStart:function(e){o.writeHead(200,{"Content-Type":e.type,"Content-Length":e.size,"Content-Disposition":"attachment; filename='"+e.name+"'"})},onPipe:function(e){e.pipe(o)},onTimeout:function(){o.writeHead(404),o.end("file not found.")},onError:function(){o.end()}})}),n}},function(e,n,o){var t,r,i,u,c,a,s;for(a=o(15),t=o(16).ArgumentParser,c=new t({version:a.version,addHelp:!0,description:"XChat",prog:"xchat"}),r=[["-a","--addr"],{help:"指定监听IP",defaultValue:"0.0.0.0"},["-p","--port"],{help:"指定监听端口。",defaultValue:8888}],i=u=0,s=r.length/2;s>=0?s>u:u>s;i=s>=0?++u:--u)c.addArgument(r[2*i],r[2*i+1]);e.exports=c},function(e,n){e.exports=require("../package.json")},function(e,n){e.exports=require("argparse")}]);